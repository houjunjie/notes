### 第六章 异步：现在与将来

**并行线程**

术语“异步”和“并行”它们的意义完全不同。异步是关于`现在和将来的时间间隙，而并行是关于能够同时发生的事情`

并行计算最常见的工具就是`进程`和`线程`。进程和线程是独立运行，而且能同时运行。

**并发**

并发就是需要（至少）两个独立的“进程”同时运行（也就是说，在同一段时间内，并不需要在同一时刻）

这里的“进程”之所以打上引号,是因为这并不是计算机科学意义上的真正 操作系统级进程。这是虚拟进程,或者任务,表示一个逻辑上相关的运算序 列。之所以使用“进程”而不是“任务”,是因为从概念上来讲,“进程”的 定义更符合这里我们使用的意义。

**任务**

在es6中，有一个新的概念建立在时间循环队列之上，叫`任务队列`

任务队列：它是挂在时间循环队列的每个 tick 之后的一个队列。在事件循环的每个 tick 中，可能出现的异步动作不会导致一个完整的新事件添加到事件循环队列中，而会在当前 tick 的任务队列末尾添加一个项目（一个任务）

事件循环队列类似于一个游乐园游戏：玩过一个游戏之后，你需要重新到队尾重新排队才能再玩一次。而任务队列类似于玩过游戏之后，插队接着继续玩

一个任务可能引起更多任务被添加到同一个队列末尾。所以，理论上说，任务循环可能无限循环(一个任务总是添加另一个任务,以此类推),进而导致程序的 饿死,无法转移到下一个事件循环 tick。从概念上看,这和代码中的无限循环(就像 while(true)..)的体验几乎是一样的

小结：

实际上，JavaScript程序总是至少分为两个块：第一块现在运行；下一块将来运行，以响应某个时间。尽管程序是一块一块执行的，但是所有这些块共享对程序作用域和状态的访问，所以对状态的修改都是在之前累积的修改之上进行的。

一旦有事件需要运行，事件循环就会运行，直到队列清空。事件循环的每一轮称为一个tick。用户交互、io和定时器向事件队列中加入事件。

任意时刻，一次只能从队列中处理一个事件。执行事件的时候，可能直接或间接地引发一个或多个后续事件。

并发是指两个或多个事件链随时间发展交替执行,以至于从更高的层次来看,就像是同时 在运行(尽管在任意时刻只处理一个事件)。

通常需要对这些并发执行的“进程”(有别于操作系统中的进程概念)进行某种形式的交 互协调,比如需要确保执行顺序或者需要防止竞态出现。这些“进程”也可以通过把自身 分割为更小的块,以便其他“进程”插入进来。
